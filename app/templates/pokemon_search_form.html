<!-- templates/pokemon_search_form.html -->
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'search.css' %}">
{% endblock %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PokéAPI Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Courier New', monospace; background-color: #f8f9fa; }
        .header { background-color: #2c2c2c; padding: 2rem; text-align: center; color: white; }
        .search-bar { margin-top: 1rem; }
        .pokemon-card img { width: 100px; height: auto; }
        .type-button { border: none; padding: 5px 12px; margin: 4px; border-radius: 6px; font-weight: bold; }
        .filter-section, .sort-section { margin-top: 1.5rem; }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://raw.githubusercontent.com/PokeAPI/media/master/logo/pokeapi_256.png" alt="Logo" height="80">
        <div class="search-bar mt-3">
            <form method="GET" action="{% url 'search_pokemon' %}">
                {{ form.as_p }}
                {% if active_type %}
                    <input type="hidden" name="type" value="{{ active_type }}">
                {% endif %}
                <button type="submit" class="btn btn-primary">Pesquisar</button>
                <a href="{% url 'search_pokemon' %}" class="btn btn-secondary">Limpar</a>
                <div class="mb-3">
                    <label for="sort" class="form-label">Ordenar por:</label>
                    <select name="sort" id="sort" class="form-select" onchange="this.form.submit()">
                      <option value="">-- Padrão --</option>
                      <option value="name_asc" {% if sort_option == "name_asc" %}selected{% endif %}>Nome (A → Z)</option>
                      <option value="name_desc" {% if sort_option == "name_desc" %}selected{% endif %}>Nome (Z → A)</option>
                      <option value="id_asc" {% if sort_option == "id_asc" %}selected{% endif %}>ID (↑)</option>
                      <option value="id_desc" {% if sort_option == "id_desc" %}selected{% endif %}>ID (↓)</option>
                      <option value="exp_desc" {% if sort_option == "exp_desc" %}selected{% endif %}>EXP / Total Points (↓)</option>
                      <option value="exp_asc" {% if sort_option == "exp_asc" %}selected{% endif %}>EXP / Total Points (↑)</option>
                    </select>
                  </div>
            </form>
            <p class="text-light mt-2">Use this input to search for any Pokémon. In an instant.</p>
        </div>
    </div>

<div class="container mt-4">

    <div class="text-center">
        <h5>Filter by type:</h5>
        <div class="type-list d-flex flex-wrap justify-content-center">
            {% for t in pokemon_types %}
                <a href="?type={{ t }}{% if name_filter %}&name={{ name_filter }}{% endif %}"
                class="type {{ t }} {% if t == active_type %}border border-dark{% endif %}">
                    {{ t|title }}
                </a>
            {% endfor %}
            <a href="{% url 'search_pokemon' %}" class="btn btn-secondary btn-sm ms-2">Reset</a>
        </div>
    </div>

    <div class="row mt-4">
        {% for pokemon in pokemons %}
        <div class="col-md-2 col-sm-4 col-6 text-center mb-4">
            <div class="card shadow-sm p-3">
                <img src="{{ pokemon.image_url }}" alt="{{ pokemon.name }}">
                <div class="mt-2">
                    <small>#{{ pokemon.number|stringformat:"03d" }} - EXP: {{ pokemon.exp }}</small>
                    <h6>{{ pokemon.name }}</h6>
                    <div class="type-badges">
                        <span class="type {{ pokemon.primary_type }}">{{ pokemon.primary_type|title }}</span>
                        {% if pokemon.secondary_type %}
                          <span class="type {{ pokemon.secondary_type }}">{{ pokemon.secondary_type|title }}</span>
                        {% endif %}
                    </div>                       
                </div>
                <a href="{% url 'pokemon_stats' pokemon.id %}" class="btn btn-sm btn-outline-dark mt-2">Ver Detalhes</a>
            </div>
        </div>
        {% empty %}
        <div class="text-center mt-5">
            <h4>Nenhum Pokémon encontrado.</h4>
        </div>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">

            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link"
                href="?page={{ page_obj.previous_page_number }}{% if name_filter %}&name={{ name_filter }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}
                ">
                Anterior
                </a>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if num == 1 %}
                    <li class="page-item">
                    <a class="page-link" href="?page=1{% if name_filter %}&name={{ name_filter }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}
                    ">1</a>
                    </li>
                
                {% elif num == page_obj.number %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                
                {% elif num == page_obj.paginator.num_pages %}
                    <li class="page-item">
                    <a class="page-link" href="?page={{ num }}{% if name_filter %}&name={{ name_filter }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}
                    ">{{ num }}</a>
                    </li>
                
                {% elif num == page_obj.number|add:'-1' or num == page_obj.number|add:'1' %}
                    <li class="page-item">
                    <a class="page-link" href="?page={{ num }}{% if name_filter %}&name={{ name_filter }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}
                    ">{{ num }}</a>
                    </li>
                
                {% elif num == 2 or num == page_obj.paginator.num_pages|add:'-1' %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link"
                href="?page={{ page_obj.next_page_number }}{% if name_filter %}&name={{ name_filter }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}{% if sort_option %}&sort={{ sort_option }}{% endif %}
                ">
                Próxima
                </a>
            </li>
            {% endif %}

        </ul>
    </nav>
    {% endif %}
</div>

</body>
</html>